<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Avaliação Pré‑Quimioterapia – Ficha / PDF</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #fff;
    }
    .container {
      max-width: 740px;
      margin: 30px auto;
      padding: 20px;
      background: #fff;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    form .campo {
      margin-bottom: 12px;
    }
    form .campo label {
      display: block;
      font-weight: bold;
      margin-bottom: 4px;
    }
    form .campo input,
    form .campo select,
    form .campo textarea {
      width: 100%;
      padding: 6px;
      font-size: 14px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    form .campo textarea {
      resize: vertical;
      min-height: 40px;
    }
    button {
      margin-top: 20px;
      padding: 10px 24px;
      background: #007bff;
      color: #fff;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }

    .ficha {
      display: none;
      margin-top: 30px;
      font-size: 14px;
      line-height: 1.5;
      color: #000;
    }
    .ficha h3 {
      text-align: center;
      margin-bottom: 12px;
      text-decoration: underline;
    }
    .ficha .linha {
      margin-bottom: 6px;
    }
    .ficha .linha span.titulo {
      font-weight: bold;
    }

    @media print {
      body {
        margin: 0;
        padding: 0;
      }
      .container * {
        visibility: hidden;
      }
      .ficha {
        display: block;
        visibility: visible;
        margin: 0 auto;
        padding: 0;
        width: 100%;
        max-width: 740px;
        border: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Avaliação Pré‑Quimioterapia</h2>
    <form id="formQuimio">
      <!-- Identificação / Demografia -->
      <div class="campo">
        <label for="Paciente_ID">Paciente_ID</label>
        <input type="text" id="Paciente_ID" name="Paciente_ID" required>
      </div>
      <div class="campo">
        <label for="Nome_Completo">Nome Completo</label>
        <input type="text" id="Nome_Completo" name="Nome_Completo">
      </div>
      <div class="campo">
        <label for="Sexo">Sexo (M/F)</label>
        <select id="Sexo" name="Sexo">
          <option value="">Selecione</option>
          <option value="M">M</option>
          <option value="F">F</option>
        </select>
      </div>
      <div class="campo">
        <label for="Data_Nascimento">Data de Nascimento</label>
        <input type="date" id="Data_Nascimento" name="Data_Nascimento">
      </div>
      <div class="campo">
        <label for="Idade">Idade (anos)</label>
        <input type="number" id="Idade" name="Idade" min="0">
      </div>
      <div class="campo">
        <label for="Peso_kg">Peso (kg)</label>
        <input type="number" id="Peso_kg" name="Peso_kg" step="0.1">
      </div>
      <div class="campo">
        <label for="Altura_cm">Altura (cm)</label>
        <input type="number" id="Altura_cm" name="Altura_cm" step="0.1">
      </div>
      <div class="campo">
        <label for="SC_m2">SC (m²)</label>
        <input type="number" id="SC_m2" name="SC_m2" step="0.01" readonly>
      </div>
      <div class="campo">
        <label for="ECOG">ECOG (0–4)</label>
        <input type="number" id="ECOG" name="ECOG" min="0" max="4">
      </div>
      <div class="campo">
        <label for="Mulher_em_idade_fertil">Mulher em idade fértil? (S/N)</label>
        <select id="Mulher_em_idade_fertil" name="Mulher_em_idade_fertil">
          <option value="">Selecione</option>
          <option value="S">S</option>
          <option value="N">N</option>
        </select>
      </div>

      <!-- Data geral da avaliação / exames -->
      <div class="campo">
        <label for="Data_Avaliacao">Data da avaliação / exames</label>
        <input type="date" id="Data_Avaliacao" name="Data_Avaliacao">
      </div>

      <!-- Exames (valor somente) -->
      <div class="campo">
        <label for="beta_hCG_valor">beta‑hCG Valor</label>
        <input type="text" id="beta_hCG_valor" name="beta_hCG_valor">
      </div>
      <div class="campo">
        <label for="Creatinina_valor">Creatinina Valor</label>
        <input type="text" id="Creatinina_valor" name="Creatinina_valor">
      </div>
      <div class="campo">
        <label for="Ureia_valor">Ureia Valor</label>
        <input type="text" id="Ureia_valor" name="Ureia_valor">
      </div>
      <div class="campo">
        <label for="Sodio_valor">Sódio Valor</label>
        <input type="text" id="Sodio_valor" name="Sodio_valor">
      </div>
      <div class="campo">
        <label for="Potassio_valor">Potássio Valor</label>
        <input type="text" id="Potassio_valor" name="Potassio_valor">
      </div>
      <div class="campo">
        <label for="Magnesio_valor">Magnésio Valor</label>
        <input type="text" id="Magnesio_valor" name="Magnesio_valor">
      </div>
      <div class="campo">
        <label for="Fosforo_valor">Fósforo Valor</label>
        <input type="text" id="Fosforo_valor" name="Fosforo_valor">
      </div>
      <div class="campo">
        <label for="Calcio_ionico_valor">Cálcio iônico Valor</label>
        <input type="text" id="Calcio_ionico_valor" name="Calcio_ionico_valor">
      </div>
      <div class="campo">
        <label for="Acido_Urico_valor">Ácido Úrico Valor</label>
        <input type="text" id="Acido_Urico_valor" name="Acido_Urico_valor">
      </div>
      <div class="campo">
        <label for="LDH_valor">LDH Valor</label>
        <input type="text" id="LDH_valor" name="LDH_valor">
      </div>
      <div class="campo">
        <label for="Albumina_valor">Albumina Valor</label>
        <input type="text" id="Albumina_valor" name="Albumina_valor">
      </div>
      <div class="campo">
        <label for="TGO_valor">TGO (AST) Valor</label>
        <input type="text" id="TGO_valor" name="TGO_valor">
      </div>
      <div class="campo">
        <label for="TGP_valor">TGP (ALT) Valor</label>
        <input type="text" id="TGP_valor" name="TGP_valor">
      </div>
      <div class="campo">
        <label for="Bilirrubina_total_valor">Bilirrubina Total Valor</label>
        <input type="text" id="Bilirrubina_total_valor" name="Bilirrubina_total_valor">
      </div>
      <div class="campo">
        <label for="Bilirrubina_direta_valor">Bilirrubina Direta Valor</label>
        <input type="text" id="Bilirrubina_direta_valor" name="Bilirrubina_direta_valor">
      </div>
      <div class="campo">
        <label for="Bilirrubina_indireta_valor">Bilirrubina Indireta Valor</label>
        <input type="text" id="Bilirrubina_indireta_valor" name="Bilirrubina_indireta_valor">
      </div>
      <div class="campo">
        <label for="TP_valor">TP Valor</label>
        <input type="text" id="TP_valor" name="TP_valor">
      </div>
      <div class="campo">
        <label for="KTTP_valor">kTTP Valor</label>
        <input type="text" id="KTTP_valor" name="KTTP_valor">
      </div>
      <div class="campo">
        <label for="Fibrinogenio_valor">Fibrinogênio Valor</label>
        <input type="text" id="Fibrinogenio_valor" name="Fibrinogenio_valor">
      </div>

      <!-- Seções ECG e ECOcardio -->
      <h3>ECG</h3>
      <div class="campo">
        <label for="ECG_frequencia">Frequência cardíaca (bpm)</label>
        <input type="number" id="ECG_frequencia" name="ECG_frequencia">
      </div>
      <div class="campo">
        <label>Ritmo</label>
        <div>
          <label><input type="radio" name="ECG_ritmo" value="Sinusal"> Sinusal</label>
          <label><input type="radio" name="ECG_ritmo" value="Outro"> Outro:</label>
          <input type="text" id="ECG_ritmo_outro" name="ECG_ritmo_outro" placeholder="Descreva se outro">
        </div>
      </div>
      <div class="campo">
        <label for="ECG_QTc">Intervalo QTc (ms)</label>
        <input type="text" id="ECG_QTc" name="ECG_QTc">
      </div>

      <h3>ECOcardiograma</h3>
      <div class="campo">
        <label for="ECO_FE">Fração de ejeção (FE) (%)</label>
        <input type="text" id="ECO_FE" name="ECO_FE">
      </div>
      <div class="campo">
        <label>Função sistólica</label>
        <select id="ECO_sistolica" name="ECO_sistolica">
          <option value="">Selecione</option>
          <option value="Normal">Normal</option>
          <option value="Alterada">Alterada</option>
        </select>
      </div>
      <div class="campo">
        <label>Função diastólica</label>
        <select id="ECO_diastolica" name="ECO_diastolica">
          <option value="">Selecione</option>
          <option value="Normal">Normal</option>
          <option value="Alterada">Alterada</option>
        </select>
      </div>

      <div class="campo">
        <label for="Observacoes">Observações</label>
        <textarea id="Observacoes" name="Observacoes"></textarea>
      </div>

      <div class="campo">
        <label for="Avaliacao_Minima_Concluida">Avaliação Mínima Concluída (S/N)</label>
        <select id="Avaliacao_Minima_Concluida" name="Avaliacao_Minima_Concluida">
          <option value="">Selecione</option>
          <option value="S">S</option>
          <option value="N">N</option>
        </select>
      </div>

      <div class="campo">
        <label for="Data_Conclusao">Data de Conclusão</label>
        <input type="date" id="Data_Conclusao" name="Data_Conclusao">
      </div>

      <div class="campo">
        <label for="Medico_Responsavel">Médico Responsável</label>
        <input type="text" id="Medico_Responsavel" name="Medico_Responsavel">
      </div>

      <div class="campo">
        <label for="CRM">CRM</label>
        <input type="text" id="CRM" name="CRM">
      </div>

      <button type="submit">Gerar Ficha / PDF</button>
    </form>

    <div class="ficha" id="fichaImpressao">
      <h3>Ficha de Avaliação Pré‑Quimioterapia</h3>
      <!-- Linha por linha -->
      <div class="linha"><span class="titulo">Paciente_ID:</span> <span id="f_Paciente_ID"></span></div>
      <div class="linha"><span class="titulo">Nome Completo:</span> <span id="f_Nome_Completo"></span></div>
      <div class="linha"><span class="titulo">Sexo:</span> <span id="f_Sexo"></span></div>
      <div class="linha"><span class="titulo">Data de Nascimento:</span> <span id="f_Data_Nascimento"></span></div>
      <div class="linha"><span class="titulo">Idade (anos):</span> <span id="f_Idade"></span></div>
      <div class="linha"><span class="titulo">Peso (kg):</span> <span id="f_Peso_kg"></span></div>
      <div class="linha"><span class="titulo">Altura (cm):</span> <span id="f_Altura_cm"></span></div>
      <div class="linha"><span class="titulo">SC (m²):</span> <span id="f_SC_m2"></span></div>
      <div class="linha"><span class="titulo">ECOG:</span> <span id="f_ECOG"></span></div>
      <div class="linha"><span class="titulo">Mulher em idade fértil?</span> <span id="f_Mulher_em_idade_fertil"></span></div>
      <div class="linha"><span class="titulo">Data da Avaliação / Exames:</span> <span id="f_Data_Avaliacao"></span></div>
      
      <h4>Exames Laboratoriais</h4>
      <div class="linha"><span class="titulo">beta‑hCG Valor:</span> <span id="f_beta_hCG_valor"></span></div>
      <div class="linha"><span class="titulo">Creatinina:</span> <span id="f_Creatinina_valor"></span></div>
      <div class="linha"><span class="titulo">Ureia:</span> <span id="f_Ureia_valor"></span></div>
      <div class="linha"><span class="titulo">Sódio:</span> <span id="f_Sodio_valor"></span></div>
      <div class="linha"><span class="titulo">Potássio:</span> <span id="f_Potassio_valor"></span></div>
      <div class="linha"><span class="titulo">Magnésio:</span> <span id="f_Magnesio_valor"></span></div>
      <div class="linha"><span class="titulo">Fósforo:</span> <span id="f_Fosforo_valor"></span></div>
      <div class="linha"><span class="titulo">Cálcio iônico:</span> <span id="f_Calcio_ionico_valor"></span></div>
      <div class="linha"><span class="titulo">Ácido Úrico:</span> <span id="f_Acido_Urico_valor"></span></div>
      <div class="linha"><span class="titulo">LDH:</span> <span id="f_LDH_valor"></span></div>
      <div class="linha"><span class="titulo">Albumina:</span> <span id="f_Albumina_valor"></span></div>
      <div class="linha"><span class="titulo">TGO (AST):</span> <span id="f_TGO_valor"></span></div>
      <div class="linha"><span class="titulo">TGP (ALT):</span> <span id="f_TGP_valor"></span></div>
      <div class="linha"><span class="titulo">Bilirrubina Total:</span> <span id="f_Bilirrubina_total_valor"></span></div>
      <div class="linha"><span class="titulo">Bilirrubina Direta:</span> <span id="f_Bilirrubina_direta_valor"></span></div>
      <div class="linha"><span class="titulo">Bilirrubina Indireta:</span> <span id="f_Bilirrubina_indireta_valor"></span></div>
      <div class="linha"><span class="titulo">TP:</span> <span id="f_TP_valor"></span></div>
      <div class="linha"><span class="titulo">kTTP:</span> <span id="f_KTTP_valor"></span></div>
      <div class="linha"><span class="titulo">Fibrinogênio:</span> <span id="f_Fibrinogenio_valor"></span></div>

      <h4>ECG</h4>
      <div class="linha"><span class="titulo">Freq. cardíaca (bpm):</span> <span id="f_ECG_frequencia"></span></div>
      <div class="linha"><span class="titulo">Ritmo:</span> <span id="f_ECG_ritmo"></span></div>
      <div class="linha"><span class="titulo">QTc (ms):</span> <span id="f_ECG_QTc"></span></div>

      <h4>ECOcardiograma</h4>
      <div class="linha"><span class="titulo">FE (%):</span> <span id="f_ECO_FE"></span></div>
      <div class="linha"><span class="titulo">Função sistólica:</span> <span id="f_ECO_sistolica"></span></div>
      <div class="linha"><span class="titulo">Função diastólica:</span> <span id="f_ECO_diastolica"></span></div>

      <div class="linha"><span class="titulo">Observações:</span> <span id="f_Observacoes"></span></div>
      <div class="linha"><span class="titulo">Avaliação Mínima Concluída:</span> <span id="f_Avaliacao_Minima_Concluida"></span></div>
      <div class="linha"><span class="titulo">Data de Conclusão:</span> <span id="f_Data_Conclusao"></span></div>
      <div class="linha"><span class="titulo">Médico Responsável:</span> <span id="f_Medico_Responsavel"></span></div>
      <div class="linha"><span class="titulo">CRM:</span> <span id="f_CRM"></span></div>
    </div>
  </div>

  <script>
    // FUNÇÃO para calcular SC automaticamente
    function calcularSC() {
      const peso = parseFloat(document.getElementById('Peso_kg').value);
      const altura = parseFloat(document.getElementById('Altura_cm').value);
      if (!isNaN(peso) && !isNaN(altura)) {
        const sc = 0.007184 * Math.pow(peso, 0.425) * Math.pow(altura, 0.725);
        document.getElementById('SC_m2').value = sc.toFixed(2);
      } else {
        document.getElementById('SC_m2').value = '';
      }
    }
    document.getElementById('Peso_kg').addEventListener('input', calcularSC);
    document.getElementById('Altura_cm').addEventListener('input', calcularSC);

    // Ao submeter, preencher ficha e gerar PDF
    document.getElementById('formQuimio').addEventListener('submit', async function(event) {
      event.preventDefault();
      const form = event.target;

      // Lista de campos simples
      const campos = [
        "Paciente_ID","Nome_Completo","Sexo","Data_Nascimento","Idade","Peso_kg","Altura_cm","SC_m2",
        "ECOG","Mulher_em_idade_fertil","Data_Avaliacao","beta_hCG_valor","Creatinina_valor",
        "Ureia_valor","Sodio_valor","Potassio_valor","Magnesio_valor","Fosforo_valor","Calcio_ionico_valor",
        "Acido_Urico_valor","LDH_valor","Albumina_valor","TGO_valor","TGP_valor","Bilirrubina_total_valor",
        "Bilirrubina_direta_valor","Bilirrubina_indireta_valor","TP_valor","KTTP_valor","Fibrinogenio_valor",
        "Observacoes","Avaliacao_Minima_Concluida","Data_Conclusao","Medico_Responsavel","CRM"
      ];

      // Campos específicos ECG / ECO
      const ECG_frequencia = form.ECG_frequencia.value;
      const ritmoRadios = form.elements["ECG_ritmo"];
      let ritmo = "";
      if (ritmoRadios) {
        for (const r of ritmoRadios) {
          if (r.checked) {
            if (r.value === "Outro") {
              const outro = form.ECG_ritmo_outro.value;
              ritmo = outro ? outro : "Outro";
            } else {
              ritmo = r.value;
            }
          }
        }
      }
      const ECG_QTc = form.ECG_QTc.value;

      const ECO_FE = form.ECO_FE.value;
      const ECO_sistolica = form.ECO_sistolica.value;
      const ECO_diastolica = form.ECO_diastolica.value;

      // Preencher ficha da tela
      campos.forEach(nomeCampo => {
        const input = form[nomeCampo];
        const valor = input ? input.value : '';
        const target = document.getElementById('f_' + nomeCampo);
        if (target) {
          target.textContent = valor || '—';
        }
      });
      document.getElementById('f_ECG_frequencia').textContent = ECG_frequencia || '—';
      document.getElementById('f_ECG_ritmo').textContent = ritmo || '—';
      document.getElementById('f_ECG_QTc').textContent = ECG_QTc || '—';
      document.getElementById('f_ECO_FE').textContent = ECO_FE || '—';
      document.getElementById('f_ECO_sistolica').textContent = ECO_sistolica || '—';
      document.getElementById('f_ECO_diastolica').textContent = ECO_diastolica || '—';

      const ficha = document.getElementById('fichaImpressao');
      ficha.style.display = 'block';

      // Gerar PDF com jsPDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        unit: 'pt',
        format: 'a4'
      });

      const linhaAltura = 14;
      let y = 40;

      doc.setFontSize(16);
      doc.text("Ficha de Avaliação Pré‑Quimioterapia", 40, y);
      y += 30;
      doc.setFontSize(12);

      function printLinha(titulo, valor) {
        doc.text(titulo + ": " + valor, 40, y);
        y += linhaAltura;
      }

      // Exibir campos gerais
      campos.forEach(nomeCampo => {
        const elem = document.getElementById('f_' + nomeCampo);
        const val = elem ? elem.textContent : '';
        printLinha(nomeCampo, val);
      });

      // ECG e ECO
      doc.text("ECG", 40, y);
      y += linhaAltura;
      printLinha("Frequência cardíaca (bpm)", ECG_frequencia || '—');
      printLinha("Ritmo", ritmo || '—');
      printLinha("QTc (ms)", ECG_QTc || '—');

      doc.text("ECOcardiograma", 40, y);
      y += linhaAltura;
      printLinha("FE (%)", ECO_FE || '—');
      printLinha("Função sistólica", ECO_sistolica || '—');
      printLinha("Função diastólica", ECO_diastolica || '—');

      // Observações finais
      const obs = document.getElementById('f_Observacoes').textContent || '—';
      printLinha("Observações", obs);

      // Assinatura / rodapé se quiser
      doc.setFontSize(10);
      doc.text(`Gerado em: ${new Date().toLocaleString()}`, 40, doc.internal.pageSize.height - 40);

      // Salvar / abrir PDF
      doc.save("Ficha_Avaliacao_Quimioterapia.pdf");
    });
  </script>
</body>
</html>

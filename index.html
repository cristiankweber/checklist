<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HemoTransplant Pro | Plataforma de Gest√£o de TCTH</title>
  <meta name="description" content="Plataforma completa para gest√£o de dados cl√≠nicos de transplante de c√©lulas-tronco hematopoi√©ticas com seguran√ßa, conformidade regulat√≥ria e experi√™ncia moderna." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="assets/styles.css" />
  <script defer src="assets/app.js"></script>
</head>
<body>
  <div class="app-shell">
    <header class="topbar" aria-label="Barra superior e navega√ß√£o principal">
      <div class="brand-area">
        <span class="brand-logo" aria-hidden="true">HT</span>
        <div class="brand-text">
          <strong>HemoTransplant Pro</strong>
          <span>Sistema integrado de TCTH</span>
        </div>
      </div>
      <nav class="main-nav" aria-label="Navega√ß√£o principal">
        <a class="nav-link is-active" data-target="overview" href="#visao-geral">Vis√£o geral</a>
        <a class="nav-link" data-target="patients" href="#pacientes">Pacientes</a>
        <a class="nav-link" data-target="protocols" href="#protocolos">Protocolos</a>
        <a class="nav-link" data-target="reports" href="#relatorios">Relat√≥rios</a>
        <a class="nav-link" data-target="governance" href="#governanca">Governan√ßa</a>
      </nav>
      <div class="topbar-actions">
        <button class="btn ghost" type="button" id="toggleHelp" aria-expanded="false">
          <span class="icon">‚ùî</span>
          <span class="btn-label">Central de ajuda</span>
        </button>
        <button class="btn ghost" type="button" id="toggleTheme" aria-pressed="false">
          <span class="icon" aria-hidden="true">üåô</span>
          <span class="btn-label">Modo escuro</span>
        </button>
        <button class="btn primary" type="button">Iniciar sess√£o segura</button>
      </div>
    </header>

    <aside class="help-drawer" aria-hidden="true" id="helpDrawer">
      <div class="drawer-header">
        <h2>Central de ajuda &amp; conformidade</h2>
        <button class="btn ghost icon-only" type="button" id="closeHelp" aria-label="Fechar central de ajuda">‚úï</button>
      </div>
      <div class="drawer-content">
        <article>
          <h3>Conformidade regulat√≥ria</h3>
          <p>
            O HemoTransplant Pro est√° alinhado com as diretrizes da ANVISA, GDPR e HIPAA. Todos os acessos s√£o registrados,
            h√° segrega√ß√£o de fun√ß√µes e os dados permanecem criptografados em repouso e em tr√¢nsito.
          </p>
        </article>
        <article>
          <h3>Boas pr√°ticas de seguran√ßa</h3>
          <ul>
            <li>Autentica√ß√£o multifator obrigat√≥ria e rota√ß√£o de senhas a cada 90 dias.</li>
            <li>Revis√µes trimestrais de perfis de acesso e trilhas de auditoria export√°veis.</li>
            <li>Monitoramento ativo de integridade com alertas em tempo real.</li>
          </ul>
        </article>
        <article>
          <h3>Treinamento e suporte</h3>
          <p>
            Equipe cl√≠nica e de TI contam com trilhas de onboarding, biblioteca de SOPs e suporte 24/7 dedicado para d√∫vidas de opera√ß√£o e incidentes.
          </p>
        </article>
      </div>
      <div class="campo">
        <label>Fun√ß√£o diast√≥lica</label>
        <select id="ECO_diastolica" name="ECO_diastolica">
          <option value="">Selecione</option>
          <option value="Normal">Normal</option>
          <option value="Alterada">Alterada</option>
        </select>
      </div>

      <div class="campo">
        <label for="Observacoes">Observa√ß√µes</label>
        <textarea id="Observacoes" name="Observacoes"></textarea>
      </div>

      <button type="submit">Gerar PDF Tabelado</button>
    </form>
  </div>

  <script>
    // c√°lculo autom√°tico da SC
    function calcularSC() {
      const peso = parseFloat(document.getElementById('Peso_kg').value);
      const altura = parseFloat(document.getElementById('Altura_cm').value);
      if (!isNaN(peso) && !isNaN(altura)) {
        const sc = 0.007184 * Math.pow(peso, 0.425) * Math.pow(altura, 0.725);
        document.getElementById('SC_m2').value = sc.toFixed(2);
      } else {
        document.getElementById('SC_m2').value = '';
      }
    }
    document.getElementById('Peso_kg').addEventListener('input', calcularSC);
    document.getElementById('Altura_cm').addEventListener('input', calcularSC);

    document.getElementById('formQuimio').addEventListener('submit', function(event) {
      event.preventDefault();
      const form = event.target;

      // coletar dados do formul√°rio de forma gen√©rica
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // determinar ritmo selecionado
      const ritmoSelecionado = form.querySelector('input[name="ECG_ritmo"]:checked');
      data.ECG_ritmo = ritmoSelecionado
        ? (ritmoSelecionado.value === "Outro"
            ? (form.ECG_ritmo_outro.value.trim() || "Outro")
            : ritmoSelecionado.value)
        : "";

      // garante que campos num√©ricos sejam apresentados de forma amig√°vel
      ["Peso_kg", "Altura_cm", "SC_m2", "ECG_frequencia"].forEach((campo) => {
        if (data[campo]) {
          const numero = Number(data[campo].replace(',', '.'));
          if (!Number.isNaN(numero)) {
            data[campo] = numero.toString().replace('.', ',');
          }
        }
      });

      // gerar PDF com layout tabelado
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });

      const margin = 40;
      const pageWidth = doc.internal.pageSize.width;
      const pageHeight = doc.internal.pageSize.height;
      const usableWidth = pageWidth - margin * 2;
      let y = margin;

      // inserir logo no topo
      const logoUrl = "https://vidahematologia.com.br/wp-content/uploads/2025/02/vida-hematologia-logo.png";
      const logoWidth = 120;
      const logoHeight = 60;

      // fun√ß√£o auxiliar para carregar a imagem
      function loadImage(url) {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.crossOrigin = "Anonymous";
          img.src = url;
          img.onload = () => resolve(img);
          img.onerror = reject;
        });
      }

      const filtrarCampos = (entradas) =>
        entradas.filter(([, valor]) => valor && valor.toString().trim() !== "");

      const adicionarOuMensagem = (config) => {
        doc.setFont(undefined, 'bold');
        doc.text(config.titulo, margin, y);
        y += 18;
        doc.setFont(undefined, 'normal');

        if (config.linhas.length > 0) {
          doc.autoTable({
            startY: y,
            margin: { left: margin, right: margin },
            tableWidth: usableWidth,
            theme: 'grid',
            styles: { fontSize: 10, cellPadding: 4 },
            head: [config.cabecalho],
            body: config.linhas
          });
          y = doc.lastAutoTable.finalY + 20;
        } else {
          doc.text("Sem dados informados.", margin, y);
          y += 20;
        }
      };

      (async () => {
        try {
          const img = await loadImage(logoUrl);
          doc.addImage(img, 'PNG', margin, margin, logoWidth, logoHeight);
        } catch (err) {
          // falhou carregar logo, ignora
        }

        y = margin + logoHeight + 20;

        doc.setFontSize(16);
        doc.text("Ficha de Avalia√ß√£o Pr√©‚ÄëQuimioterapia", margin, y);
        y += 25;

      <section class="kpi-grid" aria-label="Indicadores estrat√©gicos">
        <article class="kpi-card">
          <header>
            <span class="kpi-label">Pacientes ativos</span>
            <span class="kpi-icon" aria-hidden="true">üë•</span>
          </header>
          <strong class="kpi-value" data-metric="activePatients">32</strong>
          <p>Em acompanhamento pr√© ou p√≥s-TCTH nas √∫ltimas 12 semanas.</p>
        </article>
        <article class="kpi-card">
          <header>
            <span class="kpi-label">Taxa de engraftment</span>
            <span class="kpi-icon" aria-hidden="true">üß¨</span>
          </header>
          <strong class="kpi-value" data-metric="engraftmentRate">92%</strong>
          <p>M√©dia rolling dos √∫ltimos 30 transplantes.</p>
        </article>
        <article class="kpi-card warning">
          <header>
            <span class="kpi-label">Alertas cr√≠ticos</span>
            <span class="kpi-icon" aria-hidden="true">‚ö†Ô∏è</span>
          </header>
          <strong class="kpi-value" data-metric="criticalAlerts">3</strong>
          <p>Eventos infecciosos em investiga√ß√£o imediata.</p>
        </article>
        <article class="kpi-card">
          <header>
            <span class="kpi-label">Conformidade documental</span>
            <span class="kpi-icon" aria-hidden="true">üìÑ</span>
          </header>
          <strong class="kpi-value" data-metric="complianceScore">98%</strong>
          <p>Checklist regulat√≥rio completo e atualizado.</p>
        </article>
      </section>

        const secoes = [
          {
            titulo: "Identifica√ß√£o e Dados Demogr√°ficos",
            cabecalho: ['Campo', 'Valor'],
            linhas: filtrarCampos([
              ["Paciente_ID", data.Paciente_ID],
              ["Nome Completo", data.Nome_Completo],
              ["Sexo", data.Sexo],
              ["Peso (kg)", data.Peso_kg],
              ["Altura (cm)", data.Altura_cm],
              ["SC (m¬≤)", data.SC_m2]
            ])
          },
          {
            titulo: "Exames Laboratoriais",
            cabecalho: ['Exame', 'Valor'],
            linhas: filtrarCampos([
              ["LDH", data.LDH_valor],
              ["Albumina", data.Albumina_valor]
            ])
          },
          {
            titulo: "ECG",
            cabecalho: ['Par√¢metro', 'Valor'],
            linhas: filtrarCampos([
              ["Frequ√™ncia (bpm)", data.ECG_frequencia],
              ["Ritmo", data.ECG_ritmo],
              ["QTc (ms)", data.ECG_QTc]
            ])
          },
          {
            titulo: "ECOcardiograma",
            cabecalho: ['Par√¢metro', 'Valor'],
            linhas: filtrarCampos([
              ["Fra√ß√£o de Eje√ß√£o (%)", data.ECO_FE],
              ["Fun√ß√£o Sist√≥lica", data.ECO_sistolica],
              ["Fun√ß√£o Diast√≥lica", data.ECO_diastolica]
            ])
          }
        ];

        for (const secao of secoes) {
          if (y + 40 > pageHeight - margin) {
            doc.addPage();
            y = margin;
          }
          adicionarOuMensagem(secao);
        }

        if (y + 60 > pageHeight - margin) {
          doc.addPage();
          y = margin;
        }

        // se√ß√£o Observa√ß√µes / assinatura
        doc.setFont(undefined, 'bold');
        doc.text("Observa√ß√µes", margin, y);
        y += 18;
        doc.setFont(undefined, 'normal');
        const obs = data.Observacoes ? data.Observacoes.trim() : "";
        if (obs) {
          const obsLines = doc.splitTextToSize(obs, usableWidth);
          doc.text(obsLines, margin, y);
          y += obsLines.length * 14 + 20;
        } else {
          doc.text("Sem observa√ß√µes adicionais.", margin, y);
          y += 20;
        }

        // rodap√©
        doc.setFontSize(10);
        const hoje = new Date();
        doc.text(`Gerado em: ${hoje.toLocaleString()}`, margin, pageHeight - margin);

  <div class="modal" id="modal-patientDetails" role="dialog" aria-modal="true" aria-labelledby="modalPatientTitle" hidden>
    <div class="modal-window">
      <header class="modal-header">
        <h2 id="modalPatientTitle">Detalhes do paciente</h2>
        <button class="btn ghost icon-only" type="button" data-close-modal aria-label="Fechar">‚úï</button>
      </header>
      <div class="modal-body" id="patientDetailsBody"></div>
      <footer class="modal-footer">
        <button class="btn secondary" type="button" data-close-modal>Fechar</button>
      </footer>
    </div>
  </div>
</body>
</html>
